(function(e){function u(a){var d=$(a).offset();this.width=Math.round($(a).outerWidth());this.height=Math.round($(a).outerHeight());this.left=d.left;this.top=d.top;var d=Array(4),b;for(b=0;4>b;b+=1)d[b]=Array(2);d[k][f]=this.left;d[k][j]=this.top;d[l][f]=this.left+this.width;d[l][j]=this.top;d[m][f]=this.left+this.width;d[m][j]=this.top+this.height;d[n][f]=this.left;d[n][j]=this.top+this.height;this.coord=d;this.popColor=$(a).css("background-color");this.coord[k][f]>=c.vanishingPoint.x&&(this.leftFace=!0);this.coord[l][f]<c.vanishingPoint.x&&(this.rightFace=!0);this.coord[k][j]>c.vanishingPoint.y&&(this.topFace=!0);this.coord[n][j]<=c.vanishingPoint.y&&(this.bottomFace=!0);this.distance=99999999;for(d=0;3>d;d+=1)a=Math.sqrt(Math.pow(c.vanishingPoint.x-this.coord[d][f],2)+Math.pow(c.vanishingPoint.y-this.coord[d][j],2)),a<this.distance&&(this.distance=a)}function p(a,d,b,e,h,l){var g=document.getElementById(c.canvasID);g.getContext&&(g=g.getContext("2d"),b=l?g.createLinearGradient(a[e][f]+b,c.vanishingPoint.y,c.vanishingPoint.x,c.vanishingPoint.y):g.createLinearGradient(a[k][f],a[m][j]+b,a[k][f],c.vanishingPoint.y),b.addColorStop(0,d),b.addColorStop(1,"black"),g.fillStyle=b,g.beginPath(),g.moveTo(a[e][f],a[e][j]),g.lineTo(c.vanishingPoint.x,c.vanishingPoint.y),g.lineTo(a[h][f],a[h][j]),c.stroke&&g.stroke(),g.fill())}function v(a,d){var b=a.distance,c=d.distance;return b<c?1:b>c?-1:0}function q(){setTimeout(function(){var a=[],d=0,b;$(c.popoutSelector).each(function(){a[a.length+=1]=new u(this);d+=1});a.sort(v);b=document.getElementById(c.canvasID);b.getContext&&(b=b.getContext("2d"),b.clearRect(0,0,$(document).width(),$(document).height()));for(b=0;b<d;b+=1)a[b].bottomFace&&p(a[b].coord,a[b].popColor,-1*c.gradientStop,n,m),a[b].topFace&&p(a[b].coord,a[b].popColor,c.gradientStop,k,l),c.noSides||(a[b].leftFace&&p(a[b].coord,a[b].popColor,c.gradientStop,k,n,!0),a[b].rightFace&&p(a[b].coord,a[b].popColor,-1*c.gradientStop,l,m,!0))},1)}function r(){var a=document;return Math.max(Math.max(a.body.scrollHeight,a.documentElement.scrollHeight),Math.max(a.body.offsetHeight,a.documentElement.offsetHeight),Math.max(a.body.clientHeight,a.documentElement.clientHeight))}function t(){"number"===typeof window.innerWidth?this.width=window.innerWidth:document.documentElement&&document.documentElement.clientWidth&&(this.width=document.documentElement.clientWidth);return this.width}var c={canvasID:e.canvasID||"depth",popoutSelector:e.popoutSelector||".pop",vanishingPoint:e.vanishingPoint||{x:Math.round($(document).width()/2),y:Math.round($(document).height()/2),recalc:!0},height:e.height||r(),gradientStop:e.gradientStop||60,stroke:e.stroke||!1,noSides:e.noSides||!1},k=0,l=1,m=2,n=3,f=0,j=1,h=document;e=h.getElementById("wrapper");var s=h.createElement("div"),h=h.createElement("canvas"),w=c.width||new t;h.setAttribute("width",w.width);h.setAttribute("height",c.height||r());h.setAttribute("id",c.canvasID);s.setAttribute("id","background");s.appendChild(h);e.parentNode.insertBefore(s,e);$(document).ready(function(){$("a.pop").bind("mouseenter mouseleave click focusin focusout",q)});$(window).resize(function(){var a=new t,d=document.getElementById(c.canvasID),b=$(document).height(),e=r();c.vanishingPoint.recalc&&(c.vanishingPoint.x=Math.round($(document).width()/2),c.vanishingPoint.y=Math.round($(document).height()/2));d.setAttribute("width",a.width);b<e&&d.setAttribute("height",e-b);q()});q()})(POPOUT_cfg);